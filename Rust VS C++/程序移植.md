## 移植程序

## Automation tools

### Corrode

Corrode是一种命令行工具，可以将部分C转换为Rust。其将采用C文件，eg：somefile.c加上gcc所有参数，并生成somefile.rs,等效于Rust中的程序。

> 它通过将C程序解析为抽象语法树，然后从中生成Rust来工作。

### Bindgen

Bindgen用于从现有C/C++头文件为Rust生成FFI接口的工具

场景： 从C/C++移植程序或编写必须与现有代码库一起使用的组件。

条件：需要预先安装Clang C++编译器，以便将程序解析。

## 其他事项

### 引用

Rust中的引用等效于C系列中的指针。通过引用传递将大小大于64位的对象传递到函数中，但不放弃所有权的有效方法。

在某些情况下最好通过引用返回，这是因为调用方可以始终根据需要克隆对象，而且在提供生命周期的前提下，以使用引用为主。

tip：不需要在固有类型（数值类型，bool类型）上使用引用，除非在下文中进行变更。

### 移动语义

C/C++默认在分配时复制，Rust会在分配时移动(前提是该类型实现了Copy trait)。

若程序在C++中运行畅通，但是到了Rust运行出错，需要留意引用是否为悬垂，对象的生命周期是否满足上下文的要求，以及是移动(Copy trait)还是克隆(Clone trait)。

### libc

Rust为C函数提供了一个带有绑定的create，若程序中有一个`malloc()`分配的指针，可以调用该库中的`free()`来释放。

```rust
cargo.toml

[dependencies]
libc="*"
```



